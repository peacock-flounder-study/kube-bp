# CH7
## 새롭게 알게 된 것
### 이미지 분산 복제
글로벌 환경에서 이미지 레지스트리가 자동 리전 복제 기능을 갖고 있어야 함
- 이미지 레지스트리 네이밍에 각 리전 명을 명시하면 편함
- 단일 레지스트리의 SPOF (but, 여러개는 비쌈 trade-off)

### 글로벌 롤아웃
- 통합 테스트
    - 실제 트래픽 없이 애플리케이션을 동일한 규모로 지정
    - 이때 앞단에 프록시를 구성하여 운영 스토리지와의 연결을 방지해야 함
- 부하 테스트
    - 가장 좋은것은 과거의 실제 데이터를 흘려보는 것 (다만 버전 충돌 등으로 동작하지 않을 수 있음)
    - 좋은 메트릭을 설계 해야함 (e.g. request latency)

### 카나리 리전
- 특정 리전에만 배포하여 점진적으로 확장
    - 개발도상국은 모바일 접속률이 높음 (이러한 리전적 특성을 반영)
- 롤아웃 이후 장애가 발생할 때까지 잠깐 대기 해야함

### 트러블 슈팅
- 발생할 수 있는 문제에 대한 대응과 절차가 필요함 (문서화 중요)
- 문제가 있는 리전의 트래픽 -> 문제가 없는 리전으로 옮기기

# CH8
## 새롭게 알게 된 것
### 우선순위
- 파드를 노드에 할당할때 내부적으로 우선순위를 계산하는 로직이 있음 (점수를 부여하여...) 
    - 동률이라면 라운드로빈
    - 종류가 많으니 검색해서 찾아보기

### Affinity & AntiAffinity
- 특정 레이블을 기준으로 antiaffinity 적용시 해당 노드에 여러개의 레플리카를 배포하지 않음
    - requiredDuringSchedulingIgnoredDuringExecution : '스케쥴링하는 동안 꼭 필요한' 조건
    - preferredDuringSchedulingIgnoredDuringExecution : '스케쥴링하는 동안 만족하면 좋은' 조건입니다. 꼭 이 조건을 만족해야하는 것은 아니라는 의미입니다.
    > 출처: https://kimjingo.tistory.com/144 [김징어의 Devlog:티스토리]

### 리소스
- `kubectl top nodes`를 하면 전체적인 리소스 잡아먹는 현황을 확인할 수 있음
- PodDisruptionBudget
    - 비자발적 중단: 하드웨어 장애 리소스 부족....
    - 자발적 중단: 노드 유지보수 관련 이슈로 drain 하는 경우
- 최소 가용을 직접 설정 가능 `minAvailable` 형태로

