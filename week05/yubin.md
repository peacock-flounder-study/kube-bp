> 지금까지는 책의 거의 모든 내용을 요약하듯이 적었는데 비효율적인 것 같아서 간단하게 정리 시도해봤습니다 어떤 방식이 나은지 탐색하는 중입니다..🧐

# 09. 네트워킹, 네트워크 보안 및 서비스 메시

### 쿠버네티스 네트워킹 원리
- 쿠버네티스는 클러스터 내 분산 시스템 간 통신을 관리하는 중심 역할을 함.
- 파드 간 통신은 나트없이 되어야함. 즉 발신자의 실제 IP가 그대로 표시됨.
- 동일 파드 내 컨테이너들은 같은 네트워크 네임스페이스를 공유하고 `localhost`로 통신.
- 서비스는 클러스터 내 안정적인 IP와 포트를 제공하며, 트래픽은 `iptables` 또는 `IPVS` 기반으로 라우팅됨

### 네트워크 플러그인
#### Kubenet
  - 네트워크 플러그인, 각 노드에 브리지(`cbr0`) 생성.
  - 파드는 클러스터 CIDR 범위 내에서 IP를 할당받음.
  - 파드 간 통신은 직접, 외부 트래픽만 NAT를 거침.
  - 단순 네트워크 스택에 적합하며 IP 자원 절약에 유리.

> Kubenet 모범사례는 생략 

#### CNI(Container Network Interface)
  - 컨테이너 런타임과 네트워크 플러그인 간 표준 인터페이스.
  - IP 주소 관리, 네트워크 추가/삭제 등 최소 기능 제공.
  - AWS VPC CNI, Azure CNI, Nuage, NSX 등 다양한 공급자 플러그인 존재.
  - 클라우드 환경에서는 공급자 SDN 호환성 반드시 확인 필요.
  - 선택 시 고가용성, 정책 지원, 네트워크 가시성 도구와의 호환성을 고려해야 함.

> CNI 도 생략

### 쿠버네티스 서비스
- 파드의 IP는 동적이므로 직접 접근은 비효율적.
- 서비스 리소스를 통해 **안정적인 가상 IP와 포트**를 제공하고, 파드와 매핑.
- **4가지 기본 서비스 타입**
  - **ClusterIP**: 클러스터 내부 접근 전용 (기본값)
  - **NodePort**: 노드 IP + 지정 포트로 외부 접근 가능.
  - **LoadBalancer**: 클라우드 로드밸런서를 통해 외부 트래픽 수용.
  - **ExternalName**: 내부 DNS 이름을 외부 FQDN에 매핑
- 서비스 API를 통해 파드 교체나 스케일링에도 IP가 변하지 않음!

### Ingress와 Ingress Controller
- HTTP(S) 수준의 트래픽 라우팅을 담당하는 API
- 도메인, 경로 기반의 라우팅 규칙을 정의하고, 백엔드 서비스로 트래픽 전달함
- TLS, 인증서, 디폴트 백엔드 등의 세부 구현은 **Ingress Controller**가 담당.
- 대표 구현: Nginx, Traefik, HAProxy 등...
- API와 컨트롤러는 분리되어 있으므로, 조직 표준에 맞는 컨트롤러를 선택하는 것이 중요.

### Gateway API
- Ingress API의 한계를 보완하는 확장형 트래픽 관리 사양.
- 더 풍부한 표현력, 확장성, 다중 리스너 지원 구조를 제공.
- 일반화된 프록시 제공, 쿠버네이스 환경의 인프라 컴포넌트에 좀 더 가깝게 모델링 → 역할기반 관리 프로세스에 적합 (기존 단점 보완도 되고)

### 네트워크 보안 정책
- 클러스터 내 트래픽 제어의 핵심 리소스.
- 네임스페이스 단위로 정의되며, `podSelector` 기반으로 허용/차단 규칙을 설정.
- East-West 트래픽(내부 파드 간) 방화벽 역할 수행.
- 정책 모범 사례

  - 민감한 워크로드부터 점진적으로 적용.
  - `default-deny` 정책을 기본으로 하되, 필요한 통신만 허용.
  - 네임스페이스별로 규칙이 분리되므로, 워크로드는 단일 네임스페이스 내에 두는 것이 관리에 유리.

### 서비스 메시
- 수백 개 서비스와 수천 엔드포인트가 통신하는 환경에서 트래픽 제어·보호·관찰을 단순화하는 기술.
- 쿠버네티스 고유 개념은 아니지만, 컨트롤 플레인 + 데이터 플레인 구조로 통신 제어.
- 주요 기능
  - 서비스 디스커버리 (내부·외부 서비스 탐색)
  - 트래픽 관찰 가능성 (Jaeger, Zipkin 등 추적 시스템 연동)
  - 상호 인증 기반 트래픽 보안 (동서/남북 트래픽 보호)
  - 서킷 브레이커, 재시도, 데드라인 등 복원력 기능 내장
- 애플리케이션 수정 없이 기능 통합 가능 — 핵심은 **사이드카 프록시**.
- 각 파드에 주입된 프록시가 네트워크 복잡성을 추상화하며 컨트롤 플레인과 정책을 동기화.
- 대표 기술: Istio, Linkerd2, 등.
- Istio는 Envoy를 데이터 플레인 프록시로 사용하고, Pilot·Mixer·Citadel 등 컨트롤 컴포넌트로 구성.

# 10. 보안 정책 및 런타임 격리
> 솔직히 10장은 이해가 잘 안되었습니다... 안해봐서 그럴수도

### 파드 보안 어드미션 컨트롤러
- 클러스터 전역에서 파드의 보안 필드를 검증하고 제어하는 컴포넌트.
- (별로 안중요한 히스토리지만) 복잡한 **PodSecurityPolicy(PSP)*- 를 대체하며, 쿠버네티스 1.22부터 도입, 1.25에서 PSP 완전 제거.
- 네임스페이스 단위로 적용되며, 세밀한 정책이 필요한 경우 **Gatekeeper*- 등 외부 솔루션 병행 권장.
- 기존 클러스터에서는 `warn`·`audit` 모드로 점진 적용 후 `enforce` 전환이 안전.

### 워크로드 격리 및 런타임 클래스
- 컨테이너 런타임 격리 수준에 따라 보안 차별화 가능.
- **CRI containerd**: 범용 런타임.
- **CRI-O**: 쿠버네티스 전용, 가벼운 런타임.
- **Firecracker**: 마이크로VM 기반 격리, 높은 보안성.
- **gVisor**: 커널 호출 가로채는 샌드박스형 런타임.
- **Kata Containers**: VM 격리 제공, 보안과 성능 절충.
- 파드 명세에서 `runtimeClassName` 설정으로 런타임 선택 가능.

### 어드미션 컨트롤러
- 워크로드 생성 시 보안 규칙을 자동 검증 및 적용.
- `SecurityContext` 기반 설정 강화 가능.
- `DenyExecOnPrivileged`, `DenyEscalatingExec` 등 정책으로 위험 동작 차단.